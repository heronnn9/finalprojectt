import*as e from"react";import n from"primereact/api";import{CSSTransition as t}from"primereact/csstransition";import{useMountEffect as r,useUpdateEffect as o,useOverlayListener as a,useUnmountEffect as l}from"primereact/hooks";import{OverlayService as i}from"primereact/overlayservice";import{Portal as c}from"primereact/portal";import{ObjectUtils as u,classNames as p,DomHandler as s,IconUtils as f,UniqueComponentId as d,ZIndexUtils as m}from"primereact/utils";import{Ripple as v}from"primereact/ripple";import{AngleRightIcon as h}from"primereact/icons/angleright";import{ChevronDownIcon as b}from"primereact/icons/chevrondown";function y(){return y=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},y.apply(this,arguments)}function g(e){if(Array.isArray(e))return e}function S(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,a,l,i=[],c=!0,u=!1;try{if(a=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=a.call(t)).done)&&(i.push(r.value),i.length!==n);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=t.return&&(l=t.return(),Object(l)!==l))return}finally{if(u)throw o}}return i}}function w(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function E(e,n){if(e){if("string"==typeof e)return w(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?w(e,n):void 0}}function O(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function G(e,n){return g(e)||S(e,n)||E(e,n)||O()}var I={defaultProps:{__TYPE:"CascadeSelect",id:null,inputRef:null,style:null,className:null,value:null,name:null,options:null,optionLabel:null,optionValue:null,optionGroupIcon:null,optionGroupLabel:null,optionGroupChildren:null,placeholder:null,itemTemplate:null,disabled:!1,dataKey:null,breakpoint:void 0,inputId:null,tabIndex:null,ariaLabelledBy:null,appendTo:null,transitionOptions:null,dropdownIcon:null,scrollHeight:"400px",onChange:null,onGroupChange:null,onBeforeShow:null,onBeforeHide:null,onShow:null,onHide:null,children:void 0},getProps:function(e){return u.getMergedProps(e,I.defaultProps)},getOtherProps:function(e){return u.getDiffProps(e,I.defaultProps)}},P=e.memo((function(t){var a=G(e.useState(null),2),l=a[0],i=a[1],c=e.useRef(null),d=function(e){t.onOptionSelect&&t.onOptionSelect(e)},m=function(e,n){var r=e.currentTarget.parentElement;switch(e.key){case"Down":case"ArrowDown":var o=b(r);o&&o.children[0].focus();break;case"Up":case"ArrowUp":var a=y(r);a&&a.children[0].focus();break;case"Right":case"ArrowRight":O(n)&&(l===n?r.children[1].children[0].children[0].focus():i(n));break;case"Left":case"ArrowLeft":i(null);var c=e.currentTarget.parentElement.parentElement.previousElementSibling;c&&c.focus();break;case"Enter":g(e,n);break;case"Tab":case"Escape":t.onPanelHide&&(t.onPanelHide(),e.preventDefault())}e.preventDefault()},b=function e(n){var t=n.nextElementSibling;return t?s.hasClass(t,"p-disabled")||!s.hasClass(t,"p-cascadeselect-item")?e(t):t:null},y=function e(n){var t=n.previousElementSibling;return t?s.hasClass(t,"p-disabled")||!s.hasClass(t,"p-cascadeselect-item")?e(t):t:null},g=function(e,n){O(n)?(i((function(e){return e===n?null:n})),t.onOptionGroupSelect&&t.onOptionGroupSelect({originalEvent:e,value:n})):t.onOptionSelect&&t.onOptionSelect({originalEvent:e,value:E(n)})},S=function(e){t.onOptionGroupSelect&&t.onOptionGroupSelect(e)},w=function(e){return t.optionLabel?u.resolveFieldData(e,t.optionLabel):e},E=function(e){return t.optionValue?u.resolveFieldData(e,t.optionValue):e},O=function(e){return Object.prototype.hasOwnProperty.call(e,t.optionGroupChildren[t.level])},I=function(e){return O(e)?(n=e,t.optionGroupLabel?u.resolveFieldData(n,t.optionGroupLabel):null):w(e);var n};r((function(){if(t.selectionPath&&t.options&&!t.dirty){var e=t.options.find((function(e){return t.selectionPath.includes(e)}));e&&i(e)}var n,r,o,a,l;t.root||(r=s.getOffset(n=c.current.parentElement),o=s.getViewport(),a=c.current.offsetParent?c.current.offsetWidth:s.getHiddenElementOuterWidth(element),l=s.getOuterWidth(n.children[0]),parseInt(r.left,10)+l+a>o.width-s.calculateScrollbarWidth()&&(c.current.style.left="-100%"))})),o((function(){i(null)}),[t.parentActive]);var C=function(n){if(O(n)&&l===n){var r=u.resolveFieldData(n,t.optionGroupChildren[t.level]);return e.createElement(P,{options:r,className:"p-cascadeselect-sublist",selectionPath:t.selectionPath,optionLabel:t.optionLabel,optionValue:t.optionValue,level:t.level+1,onOptionSelect:d,onOptionGroupSelect:S,parentActive:l===n,optionGroupLabel:t.optionGroupLabel,optionGroupChildren:t.optionGroupChildren,dirty:t.dirty,template:t.template,onPanelHide:t.onPanelHide})}return null},x=function(n,r){var o=p("p-cascadeselect-item",{"p-cascadeselect-item-group":O(n),"p-cascadeselect-item-active p-highlight":l===n},n.className),a=C(n),i=t.template?u.getJSXElement(t.template,E(n)):e.createElement("span",{className:"p-cascadeselect-item-text"},I(n)),c="p-cascadeselect-group-icon",s=t.optionGroupIcon||e.createElement(h,{className:c}),d=O(n)&&f.getJSXIcon(s,{className:c},{props:t}),b=I(n)+"_"+r;return e.createElement("li",{key:b,className:o,style:n.style,role:"none"},e.createElement("div",{className:"p-cascadeselect-item-content",onClick:function(e){return g(e,n)},tabIndex:0,onKeyDown:function(e){return m(e,n)}},i,d,e.createElement(v,null)),a)},A=p("p-cascadeselect-panel p-cascadeselect-items",t.className,{"p-input-filled":"filled"===n.inputStyle,"p-ripple-disabled":!1===n.ripple}),N=t.options?t.options.map(x):null;return e.createElement("ul",{ref:c,className:A,role:"listbox","aria-orientation":"horizontal"},N)}));function C(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=x(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,i=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return l=e.done,e},e:function(e){i=!0,a=e},f:function(){try{l||null==t.return||t.return()}finally{if(i)throw a}}}}function x(e,n){if(e){if("string"==typeof e)return A(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?A(e,n):void 0}}function A(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var N=e.memo(e.forwardRef((function(v,h){var g=I.getProps(v),S=G(e.useState(!1),2),w=S[0],E=S[1],O=G(e.useState(!1),2),x=O[0],A=O[1],N=G(e.useState(null),2),L=N[0],k=N[1],R=e.useRef(null),D=e.useRef(null),H=e.useRef(null),T=e.useRef(null),j=e.useRef(null),V=e.useRef(!1),B=e.useRef(null),F=G(a({target:R,overlay:D,listener:function(e,n){n.valid&&re()},when:x}),2),K=F[0],_=F[1],M=function(e){g.onChange&&g.onChange({originalEvent:e,value:e.value}),$(),re(),s.focus(H.current)},U=function(e){V.current=!0,g.onGroupChange&&g.onGroupChange(e)},W=function(e){return(g.optionLabel?u.resolveFieldData(e,g.optionLabel):e)||e},J=function(e){return g.optionValue?u.resolveFieldData(e,g.optionValue):e},X=function(e,n){return u.resolveFieldData(e,g.optionGroupChildren[n])},z=function(e,n){return Object.prototype.hasOwnProperty.call(e,g.optionGroupChildren[n])},$=function(){var e;if(null!=g.value&&g.options){var n,t=C(g.options);try{for(t.s();!(n=t.n()).done;){if(e=q(n.value,0))break}}catch(e){t.e(e)}finally{t.f()}}B.current=e},q=function e(n,t){if(z(n,t)){var r,o,a=C(X(n,t));try{for(a.s();!(o=a.n()).done;){if(r=e(o.value,t+1))return r.unshift(n),r}}catch(e){a.e(e)}finally{a.f()}}else if(u.equals(g.value,J(n),g.dataKey))return[n];return null},Y=function(e){g.disabled||D.current&&D.current.contains(e.target)||(s.focus(H.current),x?re():te())},Z=function(){E(!0)},Q=function(){E(!1)},ee=function(e){switch(e.which){case 40:x?s.findSingle(D.current,".p-cascadeselect-item").children[0].focus():e.altKey&&g.options&&g.options.length&&te(),e.preventDefault();break;case 32:x?re():te(),e.preventDefault();break;case 9:re()}},ne=function(e){i.emit("overlay-click",{originalEvent:e,target:R.current})},te=function(){g.onBeforeShow&&g.onBeforeShow(),A(!0)},re=function(){g.onBeforeHide&&g.onBeforeHide(),A(!1),s.focus(H.current)},oe=function(){m.set("overlay",D.current,n.autoZIndex,n.zIndex.overlay),ce(),L&&g.breakpoint&&(D.current.setAttribute(L+"_panel",""),ue())},ae=function(){K(),g.onShow&&g.onShow()},le=function(){_(),V.current=!1},ie=function(){m.clear(D.current),g.onHide&&g.onHide(),pe()},ce=function(){s.alignOverlay(D.current,T.current.parentElement,g.appendTo||n.appendTo)},ue=function(){if(!j.current){j.current=s.createInlineStyle(n.nonce);var e="".concat(L,"_panel"),t="\n@media screen and (max-width: ".concat(g.breakpoint,") {\n    .p-cascadeselect-panel[").concat(e,"] .p-cascadeselect-items-wrapper > ul {\n        max-height: ").concat(g.scrollHeight,";\n        overflow: ").concat(g.scrollHeight?"auto":"",";\n    }\n\n    .p-cascadeselect-panel[").concat(e,"] .p-cascadeselect-sublist {\n        position: relative;\n    }\n\n    .p-cascadeselect-panel[").concat(e,"] .p-cascadeselect-item-active > .p-cascadeselect-sublist {\n        left: 0 !important;\n        box-shadow: none;\n        border-radius: 0;\n        padding: 0 0 0 calc(var(--inline-spacing) * 2); /* @todo */\n    }\n\n    .p-cascadeselect-panel[").concat(e,'] .p-cascadeselect-group-icon:before {\n        content: "\\e930";\n    }\n}\n');j.current.innerHTML=t}},pe=function(){j.current=s.removeInlineStyle(j.current)};e.useImperativeHandle(h,(function(){return{props:g,getElement:function(){return R.current},getOverlay:function(){return D.current},getInput:function(){return H.current},getLabel:function(){return T.current},focus:function(){return s.focus(H.current)}}})),r((function(){g.breakpoint&&!L&&k(d())})),e.useEffect((function(){u.combinedRefs(H,g.inputRef)}),[H,g.inputRef]),o((function(){$()}),[g.value]),l((function(){m.clear(D.current)}));var se=function(){var n="p-cascadeselect-trigger-icon",t=f.getJSXIcon(g.dropdownIcon||e.createElement(b,{className:n}),{className:n},{props:g});return e.createElement("div",{className:"p-cascadeselect-trigger",role:"button","aria-haspopup":"listbox","aria-expanded":x},t)},fe=I.getOtherProps(g);u.reduceKeys(fe,s.DATA_PROPS);var de,me,ve,he,be,ye,ge,Se,we=u.reduceKeys(fe,s.ARIA_PROPS);return he=p("p-cascadeselect p-component p-inputwrapper",{"p-disabled":g.disabled,"p-focus":w,"p-inputwrapper-filled":g.value,"p-inputwrapper-focus":w||x},g.className),de=g.value?W(g.value):void 0,be=e.createElement("div",{className:"p-hidden-accessible"},e.createElement("input",y({ref:H,type:"text",id:g.inputId,name:g.name,defaultValue:de,readOnly:!0,disabled:g.disabled,onFocus:Z,onBlur:Q,onKeyDown:ee,tabIndex:g.tabIndex,"aria-haspopup":"listbox"},we))),me=g.value?W(g.value):g.placeholder||"p-emptylabel",ve=p("p-cascadeselect-label ",{"p-placeholder":me===g.placeholder,"p-cascadeselect-label-empty":!g.value&&"p-emptylabel"===me}),ye=e.createElement("span",{ref:T,className:ve},me),ge=se(),Se=e.createElement(c,{element:e.createElement(t,{nodeRef:D,classNames:"p-connected-overlay",in:x,timeout:{enter:120,exit:100},options:g.transitionOptions,unmountOnExit:!0,onEnter:oe,onEntered:ae,onExit:le,onExited:ie},e.createElement("div",{ref:D,className:"p-cascadeselect-panel p-component",onClick:ne},e.createElement("div",{className:"p-cascadeselect-items-wrapper"},e.createElement(P,{options:g.options,selectionPath:B.current,className:"p-cascadeselect-items",optionGroupIcon:g.optionGroupIcon,optionLabel:g.optionLabel,optionValue:g.optionValue,level:0,optionGroupLabel:g.optionGroupLabel,optionGroupChildren:g.optionGroupChildren,onOptionSelect:M,onOptionGroupSelect:U,root:!0,template:g.itemTemplate,onPanelHide:re})))),appendTo:g.appendTo}),e.createElement("div",y({ref:R,id:g.id,className:he,style:g.style},fe,{onClick:Y}),be,ye,ge,Se)})));N.displayName="CascadeSelect";export{N as CascadeSelect};
