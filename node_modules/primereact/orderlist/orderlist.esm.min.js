import*as e from"react";import t,{FilterService as n}from"primereact/api";import{useMountEffect as r,useUpdateEffect as o}from"primereact/hooks";import{ObjectUtils as l,IconUtils as i,DomHandler as a,classNames as c,UniqueComponentId as u}from"primereact/utils";import{Button as s}from"primereact/button";import{AngleDownIcon as p}from"primereact/icons/angledown";import{AngleDoubleUpIcon as f}from"primereact/icons/angledoubleup";import{AngleUpIcon as d}from"primereact/icons/angleup";import{AngleDoubleDownIcon as m}from"primereact/icons/angledoubledown";import{Ripple as v}from"primereact/ripple";import{SearchIcon as g}from"primereact/icons/search";function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},h.apply(this,arguments)}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e){if(Array.isArray(e))return y(e)}function I(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function E(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}function w(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function C(e){return b(e)||I(e)||E(e)||w()}function x(e){if(Array.isArray(e))return e}function S(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,l,i,a=[],c=!0,u=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=l.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw o}}return a}}function T(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function k(e,t){return x(e)||S(e,t)||E(e,t)||T()}var N={defaultProps:{__TYPE:"OrderList",id:null,value:null,header:null,style:null,className:null,listStyle:null,dragdrop:!1,tabIndex:0,filterIcon:null,moveUpIcon:null,moveTopIcon:null,moveDownIcon:null,moveBottomIcon:null,dataKey:null,breakpoint:"960px",onChange:null,itemTemplate:null,filter:!1,filterBy:null,filterMatchMode:"contains",filterLocale:void 0,filterPlaceholder:null,filterTemplate:null,onFilter:null,children:void 0},getProps:function(e){return l.getMergedProps(e,N.defaultProps)},getOtherProps:function(e){return l.getDiffProps(e,N.defaultProps)}},D=e.memo((function(t){var n=t.moveUpIcon||e.createElement(d,null),r=t.moveTopIcon||e.createElement(f,null),o=t.moveDownIcon||e.createElement(p,null),i=t.moveBottomIcon||e.createElement(m,null);return e.createElement("div",{className:"p-orderlist-controls"},e.createElement(s,{type:"button",icon:n,onClick:function(e){if(t.selection){for(var n=C(t.value),r=0;r<t.selection.length;r++){var o=l.findIndexInList(t.selection[r],n,t.dataKey);if(0===o)break;var i=n[o-1];n[o-1]=n[o],n[o]=i}t.onReorder&&t.onReorder({originalEvent:e,value:n,direction:"up"})}}}),e.createElement(s,{type:"button",icon:r,onClick:function(e){if(t.selection){for(var n=C(t.value),r=0;r<t.selection.length;r++){var o=l.findIndexInList(t.selection[r],n,t.dataKey);if(0===o)break;var i=n.splice(o,1)[0];n.unshift(i)}t.onReorder&&t.onReorder({originalEvent:e,value:n,direction:"top"})}}}),e.createElement(s,{type:"button",icon:o,onClick:function(e){if(t.selection){for(var n=C(t.value),r=t.selection.length-1;r>=0;r--){var o=l.findIndexInList(t.selection[r],n,t.dataKey);if(o===n.length-1)break;var i=n[o+1];n[o+1]=n[o],n[o]=i}t.onReorder&&t.onReorder({originalEvent:e,value:n,direction:"down"})}}}),e.createElement(s,{type:"button",icon:i,onClick:function(e){if(t.selection){for(var n=C(t.value),r=t.selection.length-1;r>=0;r--){var o=l.findIndexInList(t.selection[r],n,t.dataKey);if(o===n.length-1)break;var i=n.splice(o,1)[0];n.push(i)}t.onReorder&&t.onReorder({originalEvent:e,value:n,direction:"bottom"})}}}))}));D.displayName="OrderListControls";var K=e.memo((function(t){var n,r=e.useRef(null),o=e.useRef(null),u=e.useRef(null),s=e.useRef(null),p={filter:function(e){return t.onFilterInputChange(e)},reset:function(){return t.resetFilter()}},f=function(e){return-1!==l.findIndexInList(e,t.selection,t.dataKey)},d=function(e,t){o.current!==t&&o.current+1!==t&&(u.current=t,a.addClass(e.target,"p-orderlist-droppoint-highlight"),e.preventDefault())},m=function(e){u.current=null,a.removeClass(e.target,"p-orderlist-droppoint-highlight")},h=function(e){var n=o.current>u.current?u.current:0===u.current?0:u.current-1,r=C(t.value);l.reorderArray(r,o.current,n),u.current=null,a.removeClass(e.target,"p-orderlist-droppoint-highlight"),t.onChange&&t.onChange({originalEvent:e,value:r})},y=function(e){r.current=!1},b=function(e){if(r.current){var t=s.current.getBoundingClientRect().top+a.getWindowScrollTop(),n=t+s.current.clientHeight-e.pageY,o=e.pageY-t;n<25&&n>0?s.current.scrollTop+=15:o<25&&o>0&&(s.current.scrollTop-=15)}},I=function(e){13===e.which&&e.preventDefault()},E=function(t,n){return e.createElement("li",{key:n,className:"p-orderlist-droppoint",onDragOver:function(e){return d(e,t+1)},onDragLeave:m,onDrop:h})},w=t.header?e.createElement("div",{className:"p-orderlist-header"},t.header):null,x=function(){var n="p-orderlist-filter",r=i.getJSXIcon(t.filterIcon||e.createElement(g,{className:n}),{className:n},{props:t});if(t.filter){var o=e.createElement("div",{className:"p-orderlist-filter"},e.createElement("input",{type:"text",value:t.filterValue,onChange:t.onFilter,onKeyDown:I,placeholder:t.placeholder,className:"p-orderlist-filter-input p-inputtext p-component"}),e.createElement("span",{className:"p-orderlist-filter-icon"},r));if(t.filterTemplate)o=l.getJSXElement(t.filterTemplate,{className:"p-orderlist-filter",inputProps:{inputClassName:"p-orderlist-filter-input p-inputtext p-component",onChange:t.onFilter,onKeyDown:I},filterOptions:p,iconClassName:"p-orderlist-filter-icon",element:o,props:t});return e.createElement("div",{className:"p-orderlist-filter-container"},o)}return null}(),S=(n=t.value?t.value.map((function(n,l){var i=t.itemTemplate?t.itemTemplate(n):n,a=c("p-orderlist-item",{"p-highlight":f(n)},t.className),u=JSON.stringify(n);if(t.dragdrop){var s=[];return 0===l&&s.push(E(n,l)),s.push(e.createElement("li",{key:u,className:a,onClick:function(e){return t.onItemClick({originalEvent:e,value:n,index:l})},onKeyDown:function(e){return t.onItemKeyDown({originalEvent:e,value:n,index:l})},role:"option","aria-selected":f(n),draggable:"true",onDragStart:function(e){return n=e,i=l,r.current=!0,o.current=i,void(t.dragdropScope&&n.dataTransfer.setData("text","orderlist"));var n,i},onDragEnd:y,tabIndex:t.tabIndex},i,e.createElement(v,null))),s.push(E(l,u+"_droppoint")),s}return e.createElement("li",{key:u,className:a,role:"option","aria-selected":f(n),onClick:function(e){return t.onItemClick({originalEvent:e,value:n,index:l})},onKeyDown:function(e){return t.onItemKeyDown({originalEvent:e,value:n,index:l})},tabIndex:t.tabIndex},i)})):null,e.createElement("ul",{ref:s,className:"p-orderlist-list",style:t.listStyle,onDragOver:b,role:"listbox","aria-multiselectable":!0},n));return e.createElement("div",{className:"p-orderlist-list-container"},w,x,S)}));K.displayName="OrderListSubList";var L=e.memo(e.forwardRef((function(i,s){var p=N.getProps(i),f=k(e.useState([]),2),d=f[0],m=f[1],v=k(e.useState(""),2),g=v[0],y=v[1],b=k(e.useState(null),2),I=b[0],E=b[1],w=l.isNotEmpty(g),x=e.useRef(null),S=e.useRef(null),T=e.useRef(null),L=function(e){var t,n=e.originalEvent.metaKey||e.originalEvent.ctrlKey,r=l.findIndexInList(e.value,d,p.dataKey);t=-1!==r?n?d.filter((function(e,t){return t!==r})):[e.value]:n?[].concat(C(d),[e.value]):[e.value],m(t)},O=function e(t){var n=t.nextElementSibling;return n?a.hasClass(n,"p-orderlist-item")?n:e(n):null},R=function e(t){var n=t.previousElementSibling;return n?a.hasClass(n,"p-orderlist-item")?n:e(n):null},F=function(){var e=a.findSingle(x.current,".p-orderlist-list"),t=a.find(e,".p-orderlist-item.p-highlight");if(t&&t.length)switch(T.current){case"up":a.scrollInView(e,t[0]);break;case"top":e.scrollTop=0;break;case"down":a.scrollInView(e,t[t.length-1]);break;case"bottom":setTimeout((function(){return e.scrollTop=e.scrollHeight}),100)}},P=function(){if(!S.current){S.current=a.createInlineStyle(t.nonce);var e="\n@media screen and (max-width: ".concat(p.breakpoint,") {\n    .p-orderlist[").concat(I,"] {\n        flex-direction: column;\n    }\n\n    .p-orderlist[").concat(I,"] .p-orderlist-controls {\n        padding: var(--content-padding);\n        flex-direction: row;\n    }\n\n    .p-orderlist[").concat(I,"] .p-orderlist-controls .p-button {\n        margin-right: var(--inline-spacing);\n        margin-bottom: 0;\n    }\n\n    .p-orderlist[").concat(I,"] .p-orderlist-controls .p-button:last-child {\n        margin-right: 0;\n    }\n}\n");S.current.innerHTML=e}};e.useImperativeHandle(s,(function(){return{props:p,getElement:function(){return x.current}}})),r((function(){!I&&E(u())})),o((function(){return I&&(x.current.setAttribute(I,""),P()),function(){S.current=a.removeInlineStyle(S.current)}}),[I,p.breakpoint]),o((function(){T.current&&(F(),T.current=null)}));var A=N.getOtherProps(p),j=c("p-orderlist p-component",p.className),B=function(){if(w){var e=g.trim().toLocaleLowerCase(p.filterLocale),t=p.filterBy?p.filterBy.split(","):[];return n.filter(p.value,t,e,p.filterMatchMode,p.filterLocale)}return p.value}();return e.createElement("div",h({ref:x,id:p.id,className:j,style:p.style},A),e.createElement(D,{value:B,selection:d,onReorder:function(e){p.onChange&&p.onChange({event:e.originalEvent,value:e.value}),T.current=e.direction},dataKey:p.dataKey,moveUpIcon:p.moveUpIcon,moveTopIcon:p.moveTopIcon,moveDownIcon:p.moveDownIcon,moveBottomIcon:p.moveBottomIcon}),e.createElement(K,{value:B,selection:d,onItemClick:L,onItemKeyDown:function(e){var t=e.originalEvent,n=t.currentTarget;switch(t.which){case 40:var r=O(n);r&&r.focus(),t.preventDefault();break;case 38:var o=R(n);o&&o.focus(),t.preventDefault();break;case 13:L(e),t.preventDefault()}},onFilterInputChange:function(e){var t=e.target.value;y(t),p.onFilter&&p.onFilter({originalEvent:e,filter:t})},itemTemplate:p.itemTemplate,filter:p.filter,onFilter:function(e){var t=e.target.value;y(t),p.onFilter&&p.onFilter({originalEvent:e,value:t})},resetFilter:function(){y(""),p.onFilter&&p.onFilter({filter:""})},filterTemplate:p.filterTemplate,header:p.header,listStyle:p.listStyle,dataKey:p.dataKey,dragdrop:p.dragdrop,onChange:p.onChange,tabIndex:p.tabIndex,filterIcon:p.filterIcon}))})));L.displayName="OrderList";export{L as OrderList};
