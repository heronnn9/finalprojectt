import*as e from"react";import{localeOption as t}from"primereact/api";import{Button as n}from"primereact/button";import{Messages as l}from"primereact/messages";import{ProgressBar as r}from"primereact/progressbar";import{Ripple as a}from"primereact/ripple";import{ObjectUtils as o,classNames as i,IconUtils as u,DomHandler as s}from"primereact/utils";import{PlusIcon as c}from"primereact/icons/plus";import{UploadIcon as p}from"primereact/icons/upload";import{TimesIcon as m}from"primereact/icons/times";function f(){return f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},f.apply(this,arguments)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,l=new Array(t);n<t;n++)l[n]=e[n];return l}function y(e){if(Array.isArray(e))return d(e)}function v(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function b(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function g(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(e){return y(e)||v(e)||b(e)||g()}function E(e){throw new TypeError('"'+e+'" is read-only')}function S(e){if(Array.isArray(e))return e}function N(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var l,r,a,o,i=[],u=!0,s=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(l=a.call(n)).done)&&(i.push(l.value),i.length!==t);u=!0);}catch(e){s=!0,r=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(s)throw r}}return i}}function w(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function O(e,t){return S(e)||N(e,t)||b(e,t)||w()}var P={defaultProps:{__TYPE:"FileUpload",id:null,name:null,url:null,mode:"advanced",multiple:!1,accept:null,removeIcon:null,disabled:!1,auto:!1,maxFileSize:null,invalidFileSizeMessageSummary:"{0}: Invalid file size, ",invalidFileSizeMessageDetail:"maximum upload size is {0}.",style:null,className:null,widthCredentials:!1,previewWidth:50,chooseLabel:null,uploadLabel:null,cancelLabel:null,chooseOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},uploadOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},cancelOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},customUpload:!1,headerClassName:null,headerStyle:null,contentClassName:null,contentStyle:null,headerTemplate:null,itemTemplate:null,emptyTemplate:null,progressBarTemplate:null,onBeforeUpload:null,onBeforeSend:null,onBeforeDrop:null,onBeforeSelect:null,onUpload:null,onError:null,onClear:null,onSelect:null,onProgress:null,onValidationFail:null,uploadHandler:null,onRemove:null,children:void 0},getProps:function(e){return o.getMergedProps(e,P.defaultProps)},getOtherProps:function(e){return o.getDiffProps(e,P.defaultProps)}};function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function T(e,t){if("object"!==B(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var l=n.call(e,t||"default");if("object"!==B(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function C(e){var t=T(e,"string");return"symbol"===B(t)?t:String(t)}var F={defaultProps:{__TYPE:"Badge",value:null,severity:null,size:null,style:null,className:null,children:void 0},getProps:function(e){return o.getMergedProps(e,F.defaultProps)},getOtherProps:function(e){return o.getDiffProps(e,F.defaultProps)}},z=e.memo(e.forwardRef((function(t,n){var l,r,a,u=F.getProps(t),s=e.useRef(null),c=F.getOtherProps(u),p=i("p-badge p-component",(l={"p-badge-no-gutter":o.isNotEmpty(u.value)&&1===String(u.value).length,"p-badge-dot":o.isEmpty(u.value),"p-badge-lg":"large"===u.size,"p-badge-xl":"xlarge"===u.size},r="p-badge-".concat(u.severity),a=null!==u.severity,(r=C(r))in l?Object.defineProperty(l,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):l[r]=a,l),u.className);return e.useImperativeHandle(n,(function(){return{props:u,getElement:function(){return s.current}}})),e.createElement("span",f({ref:s,className:p,style:u.style},c),u.value)})));function I(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=M(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var l=0,r=function(){};return{s:r,n:function(){return l>=e.length?{done:!0}:{done:!1,value:e[l++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw a}}}}function M(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,l=new Array(t);n<t;n++)l[n]=e[n];return l}z.displayName="Badge";var D=e.memo(e.forwardRef((function(d,y){var v=P.getProps(d),b=O(e.useState([]),2),g=b[0],S=b[1],N=O(e.useState([]),2),w=N[0],B=N[1],T=O(e.useState(0),2),C=T[0],F=T[1],M=O(e.useState(!1),2),x=M[0],D=M[1],L=O(e.useState(!1),2),R=L[0],j=L[1],U=e.useRef(null),A=e.useRef(null),k=e.useRef(null),X=e.useRef(!1),H=e.useRef(0),J=o.isNotEmpty(w),_=o.isNotEmpty(g),V=v.disabled||R,K=v.chooseLabel||v.chooseOptions.label||t("choose"),Y=v.uploadLabel||v.uploadOptions.label||t("upload"),W=v.cancelLabel||v.cancelOptions.label||t("cancel"),$=V||v.fileLimit&&v.fileLimit<=w.length+H,q=V||!J,G=V||!J,Z=function(e){return/^image\//.test(e.type)},Q=function(e,t){te();var n=h(w),l=w[t];n.splice(t,1),B(n),v.onRemove&&v.onRemove({originalEvent:e,file:l})},ee=function(e,t){te();var n=h(g),l=w[t];n.splice(t,1),S(n),v.onRemove&&v.onRemove({originalEvent:e,file:l})},te=function(){U.current&&(U.current.value="")},ne=function(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,t)).toFixed(3))+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]},le=function(e){if(!v.onBeforeSelect||!1!==v.onBeforeSelect({originalEvent:e,files:w}))if("drop"!==e.type&&ae()&&X.current)X.current=!1;else{var t=[];v.multiple&&(t=w?h(w):[]);for(var n=e.dataTransfer?e.dataTransfer.files:e.target.files,l=0;l<n.length;l++){var r=n[l];!re(r)&&oe(r)&&(Z(r)&&(r.objectURL=window.URL.createObjectURL(r)),t.push(r))}B(t),o.isNotEmpty(t)&&v.auto&&ie(t),v.onSelect&&v.onSelect({originalEvent:e,files:n}),"drop"!==e.type&&ae()?U.current&&(X.current=!0,U.current.value=""):te(),"basic"===v.mode&&t.length>0&&(U.current.style.display="none")}},re=function(e){return w.some((function(t){return t.name+t.type+t.size===e.name+e.type+e.size}))},ae=function(){return!!window.MSInputMethodContext&&!!document.documentMode},oe=function(e){if(v.maxFileSize&&e.size>v.maxFileSize){var t={severity:"error",summary:v.invalidFileSizeMessageSummary.replace("{0}",e.name),detail:v.invalidFileSizeMessageDetail.replace("{0}",ne(v.maxFileSize)),sticky:!0};return"advanced"===v.mode&&A.current.show(t),v.onValidationFail&&v.onValidationFail(e),!1}return!0},ie=function(e){if((e=e||w)&&e.nativeEvent&&(e=w),v.customUpload)v.fileLimit&&E("uploadedFileCount"),v.uploadHandler&&v.uploadHandler({files:e,options:{clear:ue,props:v}});else{j(!0);var t=new XMLHttpRequest,n=new FormData;v.onBeforeUpload&&v.onBeforeUpload({xhr:t,formData:n});var l,r=I(e);try{for(r.s();!(l=r.n()).done;){var a=l.value;n.append(v.name,a,a.name)}}catch(e){r.e(e)}finally{r.f()}t.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);F(t),v.onProgress&&v.onProgress({originalEvent:e,progress:t})}})),t.onreadystatechange=function(){4===t.readyState&&(F(0),j(!1),t.status>=200&&t.status<300?(v.fileLimit&&E("uploadedFileCount"),v.onUpload&&v.onUpload({xhr:t,files:e})):v.onError&&v.onError({xhr:t,files:e}),S((function(t){return[].concat(h(t),h(e))})),ue())},t.open("POST",v.url,!0),v.onBeforeSend&&v.onBeforeSend({xhr:t,formData:n}),t.withCredentials=v.withCredentials,t.send(n)}},ue=function(){B([]),j(!1),v.onClear&&v.onClear(),te()},se=function(){U.current.click()},ce=function(){D(!0)},pe=function(){D(!1)},me=function(e){13===e.which&&se()},fe=function(e){V||(e.dataTransfer.dropEffect="copy",e.stopPropagation(),e.preventDefault())},de=function(e){V||(e.dataTransfer.dropEffect="copy",s.addClass(k.current,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault())},ye=function(e){V||(e.dataTransfer.dropEffect="copy",s.removeClass(k.current,"p-fileupload-highlight"))},ve=function(e){if(!v.disabled&&(s.removeClass(k.current,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault(),!v.onBeforeDrop||!1!==v.onBeforeDrop(e))){var t=e.dataTransfer?e.dataTransfer.files:e.target.files;(v.multiple||o.isEmpty(w)&&t&&1===t.length)&&le(e)}},be=function(){!V&&J?ie():U.current.click()};e.useImperativeHandle(y,(function(){return{props:v,upload:ie,clear:ue,formatSize:ne,onFileSelect:le,getInput:function(){return U.current},getContent:function(){return k.current},getFiles:function(){return w},setFiles:function(e){return B(e||[])}}}));var ge,he,Ee,Se,Ne,we,Oe,Pe,Be,Te,Ce,Fe=function(e,t,n){"warning"===t.severity?Q(e,n):ee(e,n)},ze=function(t,l,r){var a=t.name+t.type+t.size,i=Z(t)?e.createElement("img",{role:"presentation",className:"p-fileupload-file-thumbnail",alt:t.name,src:t.objectURL,width:v.previewWidth}):null,u=e.createElement("div",{className:"p-fileupload-filename"},t.name),s=e.createElement("div",null,ne(t.size)),c=e.createElement("div",null,e.createElement("div",null," ",t.name),e.createElement("span",null,ne(t.size)),e.createElement(z,{className:"p-fileupload-file-badge",value:r.value,severity:r.severity})),p=e.createElement("div",null,e.createElement(n,{type:"button",icon:v.removeIcon||e.createElement(m,null),text:!0,rounded:!0,className:"p-button-danger",onClick:function(e){return Fe(e,r,l)},disabled:V})),f=e.createElement(e.Fragment,null,i,c,p);if(v.itemTemplate){var d={onRemove:function(e){return Q(e,l)},previewElement:i,fileNameElement:u,sizeElement:s,removeElement:p,formatSize:ne(t.size),element:f,index:l,props:v};f=o.getJSXElement(v.itemTemplate,t,d)}return e.createElement("div",{className:"p-fileupload-row",key:a},f)},Ie=function(){var t={severity:"success",value:"Completed"},n=g&&g.map((function(e,n){return ze(e,n,t)}));return e.createElement("div",null,n)};return"advanced"===v.mode?function(){var t,s,d,y,b,g,h,E,S,N,O,B,T,F,z,I,M,D=P.getOtherProps(v),L=i("p-fileupload p-fileupload-advanced p-component",v.className),R=i("p-fileupload-buttonbar",v.headerClassName),j=i("p-fileupload-content",v.contentClassName),X=(s=(t=v.chooseOptions).style,d=t.icon,b=i("p-button p-fileupload-choose p-component",{"p-disabled":V,"p-focus":x,"p-button-icon-only":y=t.iconOnly},t.className),g="p-button-label p-clickable",h=i("p-button-icon p-clickable",{"p-button-icon-left":!y}),E=y?e.createElement("span",{className:g,dangerouslySetInnerHTML:{__html:"&nbsp;"}}):e.createElement("span",{className:g},K),S=e.createElement("input",{ref:U,type:"file",onChange:le,multiple:v.multiple,accept:v.accept,disabled:$}),N=u.getJSXIcon(d||e.createElement(c,{className:h}),{className:h},{props:v}),e.createElement("span",{className:b,style:s,onClick:se,onKeyDown:me,onFocus:ce,onBlur:pe,tabIndex:0},S,N,E,e.createElement(a,null))),H=!v.emptyTemplate||J||_?null:o.getJSXElement(v.emptyTemplate,v);if(!v.auto){var Z=v.uploadOptions,Q=v.cancelOptions,ee=Z.iconOnly?"":Y,te=Q.iconOnly?"":W,ne=i("p-button-icon p-c",{"p-button-icon-left":!Z.iconOnly}),re=u.getJSXIcon(Z.icon||e.createElement(p,{className:ne}),{className:ne},{props:v}),ae=i("p-button-icon p-c",{"p-button-icon-left":!Q.iconOnly}),oe=u.getJSXIcon(Q.icon||e.createElement(m,{className:ae}),{className:ae},{props:v});O=e.createElement(n,{type:"button",label:ee,icon:re,onClick:ie,disabled:q,style:Z.style,className:Z.className}),B=e.createElement(n,{type:"button",label:te,icon:oe,onClick:ue,disabled:G,style:Q.style,className:Q.className})}J&&(I={severity:"warning",value:"Pending"},M=w.map((function(e,t){return ze(e,t,I)})),T=e.createElement("div",null,M),z=v.progressBarTemplate?o.getJSXElement(v.progressBarTemplate,v):e.createElement(r,{value:C,showValue:!1})),_&&(F=Ie());var be=e.createElement("div",{className:R,style:v.headerStyle},X,O,B);v.headerTemplate&&(be=o.getJSXElement(v.headerTemplate,{className:R,chooseButton:X,uploadButton:O,cancelButton:B,element:be,props:v}));return e.createElement("div",f({id:v.id,className:L,style:v.style},D),be,e.createElement("div",{ref:k,className:j,style:v.contentStyle,onDragEnter:fe,onDragOver:de,onDragLeave:ye,onDrop:ve},z,e.createElement(l,{ref:A}),J?T:null,_?F:null,H))}():"basic"===v.mode?(ge=v.chooseOptions,he=P.getOtherProps(v),Ee=i("p-fileupload p-fileupload-basic p-component",v.className),Se=i("p-button p-component p-fileupload-choose",{"p-fileupload-choose-selected":J,"p-disabled":V,"p-focus":x},ge.className),Ne=i("p-button-icon",{"p-button-icon-left":!ge.iconOnly}),we=ge.icon?ge.icon:ge.icon||J&&!v.auto?!ge.icon&&J&&!v.auto&&e.createElement(p,{className:Ne}):e.createElement(c,{className:Ne}),Oe="p-button-label p-clickable",Pe=ge.iconOnly?e.createElement("span",{className:Oe,dangerouslySetInnerHTML:{__html:"&nbsp;"}}):e.createElement("span",{className:Oe},K),Be=v.auto?Pe:e.createElement("span",{className:Oe},J?w[0].name:Pe),Te=u.getJSXIcon(we,{className:Ne},{props:v,hasFiles:J}),Ce=!J&&e.createElement("input",{ref:U,type:"file",accept:v.accept,multiple:v.multiple,disabled:V,onChange:le}),e.createElement("div",f({className:Ee,style:v.style},he),e.createElement(l,{ref:A}),e.createElement("span",{className:Se,style:ge.style,onMouseUp:be,onKeyDown:me,onFocus:ce,onBlur:pe,tabIndex:0},Te,Be,Ce,e.createElement(a,null)))):void 0})));D.displayName="FileUpload";export{D as FileUpload};
